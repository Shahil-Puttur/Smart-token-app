<!DOCTYPE html>
<html>
<head>
  <title>Take Your Token</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; padding: 20px; text-align: center; }
    input, button { padding: 10px; margin: 10px; font-size: 18px; width: 90%; max-width: 400px; }
    .token-box { font-size: 22px; margin-top: 20px; }
  </style>
</head>
<body>
  <h2>Take Your Token / ‡≤ü‡≥ã‡≤ï‡≤®‡≥ç ‡≤™‡≤°‡≥Ü‡≤Ø‡≤ø‡≤∞‡≤ø</h2>

  <input id="name" placeholder="Enter your name" />
  <input id="phone" placeholder="Enter your phone number" />
  <button onclick="getToken()">Get Token</button>

  <div class="token-box" id="yourTokenBox"></div>
  <div class="token-box" id="currentTokenBox"></div>

  <audio id="audioPlayer" controls hidden></audio>

  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      databaseURL: "https://smart-hospital-51bf4-default-rtdb.firebaseio.com/"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let tokenNumber = 0;

    function pad(num) {
      return num.toString().padStart(3, '0');
    }

    function getToken() {
      const name = document.getElementById("name").value;
      const phone = document.getElementById("phone").value;

      if (!name || !phone) return alert("Fill all fields");

      db.ref("token").once("value", (snapshot) => {
        const data = snapshot.val() || {};
        const allTokens = Object.keys(data).filter(k => k !== "current");
        const newTokenNum = pad(allTokens.length + 1);

        db.ref("token/" + newTokenNum).set({ name, phone, status: "waiting" });
        document.getElementById("yourTokenBox").innerHTML = `üéüÔ∏è Your Token: #${newTokenNum}`;
        tokenNumber = newTokenNum;

        // Listen for your turn
        db.ref("token/current").on("value", (snap) => {
          const current = snap.val() || "-";
          document.getElementById("currentTokenBox").innerHTML = `üïê Current Token: #${current}`;

          if (current === tokenNumber) {
            const audio = document.getElementById("audioPlayer");
            audio.src = `/sounds/token_${tokenNumber}.mp3`;
            audio.play();
            alert("üì¢ It's your turn!");
          }
        });
      });
    }
  </script>
</body>
</html>
